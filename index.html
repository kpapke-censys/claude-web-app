<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="description" content="GameHub - Your ultimate gaming platform with Ship Rekt, adventures, strategy games, and more">
    <meta name="keywords" content="games, gaming, PWA, Ship Rekt, strategy, adventure, mobile games">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>GameHub - Ultimate Gaming Platform</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json?v=2.0">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="GameHub">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="styles.css?v=2.0" as="style">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=2.0">
    
    <!-- Theme Detection -->
    <script>
        // Detect theme preference immediately to prevent flash
        const theme = localStorage.getItem('theme') || 'auto';
        if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>
</head>
<body>
    <!-- App Shell -->
    <div class="app" id="app">
        
        <!-- Header -->
        <header class="header" role="banner">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <span class="logo-icon animate-pulse" aria-hidden="true">üéÆ</span>
                        <span class="logo-text">GameHub</span>
                    </div>
                    
                    <nav class="nav-tabs" role="navigation" aria-label="Main navigation">
                        <button class="nav-tab active" data-view="hub" data-route="/" aria-controls="hub-view">
                            üè† Hub
                        </button>
                        <button class="nav-tab" data-view="games" data-route="/games" aria-controls="games-view">
                            üéØ Games
                        </button>
                        <button class="nav-tab" data-view="settings" data-route="/settings" aria-controls="settings-view">
                            ‚öôÔ∏è Settings
                        </button>
                    </nav>
                    
                    <div class="header-actions">
                        <button class="btn btn-ghost" id="themeToggle" aria-label="Toggle theme">
                            <span class="theme-icon">üåì</span>
                        </button>
                        <button class="btn btn-primary" id="installBtn" style="display: none;">
                            üì± Install
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main" role="main">
            
            <!-- Hub View (Landing Page) -->
            <div class="view active animate-fade-in" id="hub-view">
                <div class="main-content">
                    
                    <!-- Hero Section -->
                    <section class="hero" aria-labelledby="hero-heading">
                        <div class="container">
                            <div class="hero-content text-center">
                                <h1 id="hero-heading" class="hero-title text-3xl font-bold">
                                    Welcome to GameHub
                                </h1>
                                <p class="hero-description text-lg text-secondary">
                                    Your ultimate gaming platform featuring survival adventures, 
                                    strategy games, and immersive RPG experiences. Play anywhere, anytime!
                                </p>
                                <div class="hero-actions flex justify-center gap-4">
                                    <button class="btn btn-primary" data-action="play-survival">
                                        üèïÔ∏è Start Adventure
                                    </button>
                                    <button class="btn btn-secondary" data-action="view-games">
                                        üéÆ Browse Games
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Featured Games -->
                    <section class="featured-games section-spacing" aria-labelledby="featured-heading">
                        <div class="container">
                            <h2 id="featured-heading" class="text-2xl font-bold text-center mb-8">Featured Games</h2>
                            
                            <div class="games-grid stagger-container">
                                
                                <div class="card game-card" data-game="strategy" data-route="/games/strategy" tabindex="0" role="button" aria-label="Play Strategy Wars">
                                    <div class="card-header">
                                        <div class="game-icon">üè∞</div>
                                        <h3 class="card-title">Strategy Wars</h3>
                                        <p class="card-description">
                                            Command armies, build empires, and conquer territories in this deep 
                                            strategy game that challenges your tactical thinking.
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-primary">Strategy</div>
                                        <div class="badge badge-warning">Multiplayer</div>
                                    </div>
                                </div>

                                <div class="card game-card" data-game="survival" data-route="/games/survival" tabindex="0" role="button" aria-label="Play Survival Adventure">
                                    <div class="card-header">
                                        <div class="game-icon">üèïÔ∏è</div>
                                        <h3 class="card-title">Survival Adventure</h3>
                                        <p class="card-description">
                                            Survive in the wilderness, craft tools, build shelter, and explore a vast 
                                            open world filled with dangers and discoveries.
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-warning">Adventure</div>
                                        <div class="badge badge-success">Sandbox</div>
                                    </div>
                                </div>

                                <div class="card game-card" data-game="rpg-adventure" data-route="/games/rpg-adventure" tabindex="0" role="button" aria-label="Play RPG Adventure">
                                    <div class="card-header">
                                        <div class="game-icon">‚öîÔ∏è</div>
                                        <h3 class="card-title">RPG Adventure</h3>
                                        <p class="card-description">
                                            A complete RPG framework with turn-based combat, character progression, 
                                            quests, and exploration. Perfect for learning game development!
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-primary">RPG</div>
                                        <div class="badge badge-warning">Educational</div>
                                    </div>
                                </div>

                                <div class="card game-card" data-game="hero-crafting" data-route="/games/hero-crafting" tabindex="0" role="button" aria-label="Play Hero Forge">
                                    <div class="card-header">
                                        <div class="game-icon">ü¶∏</div>
                                        <h3 class="card-title">Hero Forge</h3>
                                        <p class="card-description">
                                            Transform your gaming achievements into legendary heroes with unique classes 
                                            and abilities. Build your collection and unlock new powers!
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-primary">RPG</div>
                                        <div class="badge badge-success">Collection</div>
                                    </div>
                                </div>

                                <div class="card game-card" data-game="house-search" data-route="/games/house-search" tabindex="0" role="button" aria-label="Play Property Risk Checker">
                                    <div class="card-header">
                                        <div class="game-icon">üè†</div>
                                        <h3 class="card-title">Property Risk Checker</h3>
                                        <p class="card-description">
                                            Check environmental risks and hazards near any property address using EPA 
                                            data and AI analysis. Make informed property decisions!
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-warning">Utility</div>
                                        <div class="badge badge-success">Real Data</div>
                                    </div>
                                </div>

                                <div class="card game-card" data-game="journal-app" data-route="/games/journal-app" tabindex="0" role="button" aria-label="Play Life Journal">
                                    <div class="card-header">
                                        <div class="game-icon">üìñ</div>
                                        <h3 class="card-title">Life Journal</h3>
                                        <p class="card-description">
                                            Document your daily life with tags and insights. Track events, people, 
                                            and experiences to reflect on your personal journey.
                                        </p>
                                    </div>
                                    <div class="game-stats">
                                        <div class="badge badge-warning">Productivity</div>
                                        <div class="badge badge-success">Personal</div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </section>

                    <!-- Platform Features -->
                    <section class="platform-features section-spacing" aria-labelledby="features-heading">
                        <div class="container">
                            <h2 id="features-heading" class="text-2xl font-bold text-center mb-8">Platform Features</h2>
                            
                            <div class="features-grid grid grid-cols-1 md:grid-cols-3 gap-6">
                                
                                <div class="feature card">
                                    <div class="feature-icon text-3xl">‚ö°</div>
                                    <h3 class="feature-title font-semibold">Lightning Fast</h3>
                                    <p class="feature-description text-sm text-secondary">
                                        Instant loading with progressive web app technology. 
                                        Play immediately without downloads or installations.
                                    </p>
                                </div>

                                <div class="feature card">
                                    <div class="feature-icon text-3xl">üì±</div>
                                    <h3 class="feature-title font-semibold">Cross-Platform</h3>
                                    <p class="feature-description text-sm text-secondary">
                                        Seamless experience across desktop, tablet, and mobile. 
                                        Your progress syncs automatically everywhere.
                                    </p>
                                </div>

                                <div class="feature card">
                                    <div class="feature-icon text-3xl">üîí</div>
                                    <h3 class="feature-title font-semibold">Secure & Private</h3>
                                    <p class="feature-description text-sm text-secondary">
                                        Your data stays on your device. No tracking, no ads, 
                                        just pure gaming experience with local storage.
                                    </p>
                                </div>

                            </div>
                        </div>
                    </section>

                </div>
            </div>


            <!-- All Games View -->
            <div class="view" id="games-view">
                <div class="main-content">
                    <div class="container">
                        <h2 class="text-2xl font-bold text-center mb-8">All Games</h2>
                        
                        <div class="games-grid stagger-container" id="allGamesGrid">
                            <!-- All games will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Individual Game Views -->
            <div class="view" id="survival-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">üèïÔ∏è Survival Adventure</h1>
                        </div>
                        
                        <div class="game-content">
                            <div class="game-description card">
                                <p>Welcome to Survival Adventure! This game is currently in development.</p>
                                <p>Survive in the wilderness, craft tools, build shelter, and explore a vast open world filled with dangers and discoveries.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view" id="strategy-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">üè∞ Strategy Wars</h1>
                        </div>
                        
                        <div class="game-content">
                            <div class="game-description card">
                                <p>Welcome to Strategy Wars! This game is currently in development.</p>
                                <p>Command armies, build empires, and conquer territories in this deep strategy game that challenges your tactical thinking.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view" id="rpg-adventure-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">‚öîÔ∏è RPG Adventure</h1>
                        </div>
                        
                        <div class="game-content" id="rpg-game-container">
                            <!-- RPG Game will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="view" id="hero-crafting-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">ü¶∏ Hero Forge</h1>
                        </div>
                        
                        <div class="game-content" id="hero-crafting-container">
                            <!-- Hero Crafting Game will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="view" id="house-search-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">üè† Property Risk Checker</h1>
                        </div>
                        
                        <div class="game-content" id="house-search-container">
                            <!-- House Search Game will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="view" id="journal-app-view">
                <div class="main-content">
                    <div class="container">
                        <div class="game-header">
                            <button class="btn btn-secondary" onclick="window.appRouter.navigateToRoute('/games')">
                                ‚Üê Back to Games
                            </button>
                            <h1 class="text-4xl font-bold text-center">üìñ Life Journal</h1>
                        </div>
                        
                        <div class="game-content" id="journal-app-container">
                            <!-- Journal App will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div class="view" id="settings-view">
                <div class="main-content">
                    <div class="container">
                        <h2 class="text-2xl font-bold">Settings</h2>
                        
                        <div class="settings-grid">
                            
                            <div class="setting-group card">
                                <h3 class="setting-title">Appearance</h3>
                                
                                <div class="setting-item">
                                    <label class="setting-label">Theme</label>
                                    <select class="input" id="themeSelect">
                                        <option value="auto">Auto</option>
                                        <option value="light">Light</option>
                                        <option value="dark">Dark</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <input type="checkbox" id="reducedMotion"> Reduce animations
                                    </label>
                                </div>
                                
                            </div>

                            <div class="setting-group card">
                                <h3 class="setting-title">Gameplay</h3>
                                
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <input type="checkbox" id="autoSave" checked> Auto-save progress
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <input type="checkbox" id="notifications"> Enable notifications
                                    </label>
                                </div>
                                
                            </div>

                            <div class="setting-group card">
                                <h3 class="setting-title">Data & Storage</h3>
                                
                                <div class="setting-item">
                                    <button class="btn btn-secondary" id="exportData">
                                        üì§ Export Save Data
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <button class="btn btn-secondary" id="importData">
                                        üì• Import Save Data
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <button class="btn btn-ghost" id="clearCache">
                                        üîÑ Clear Cache
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <button class="btn" id="resetData" style="background: var(--color-error-500); color: white;">
                                        üóëÔ∏è Reset All Data
                                    </button>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="footer" role="contentinfo">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-info">
                        <span class="status-indicator" id="onlineStatus">üü¢ Online</span>
                        <span class="status-indicator" id="saveStatus">üíæ Auto-saved</span>
                    </div>
                    
                    <div class="footer-actions">
                        <button class="btn btn-ghost" id="aboutBtn">About</button>
                        <button class="btn btn-ghost" id="helpBtn">Help</button>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Floating Action Button -->
        <button class="fab" id="fab" aria-label="Quick actions" title="Quick actions">
            ‚ö°
        </button>

    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo animate-pulse">üéÆ</div>
            <div class="loading-text">Loading GameHub...</div>
            <div class="loading-progress">
                <div class="loading-bar"></div>
            </div>
        </div>
    </div>

    <!-- Modals and Overlays will be inserted here by JavaScript -->
    <div id="modals"></div>
    <div id="toasts" class="toast-container"></div>

    <!-- Scripts -->
    <script src="shared-components.js?v=2.0" defer></script>
    <script src="user-system.js?v=2.0" defer></script>
    <script src="game-menu.js?v=2.0" defer></script>
    <script src="survival-game.js?v=2.0" defer></script>
    <script src="strategy-game.js?v=2.0" defer></script>
    <script src="house-search.js?v=2.0" defer></script>
    <script src="journal-app.js?v=2.0" defer></script>
    <!-- RPG Game Scripts -->
    <script src="rpg-data.js?v=2.0" defer></script>
    <script src="rpg-inventory.js?v=2.0" defer></script>
    <script src="rpg-combat.js?v=2.0" defer></script>
    <script src="rpg-world.js?v=2.0" defer></script>
    <script src="rpg-ui.js?v=2.0" defer></script>
    <script src="rpg-game.js?v=2.0" defer></script>
    <script src="game-manager.js?v=2.0" defer></script>
    <script src="app.js?v=2.0" defer></script>

    <!-- App Initialization -->
    <script>
        // Performance monitoring
        const startTime = performance.now();
        
        // Theme management
        class ThemeManager {
            constructor() {
                this.theme = localStorage.getItem('theme') || 'auto';
                this.init();
            }

            init() {
                this.applyTheme();
                this.setupThemeToggle();
                this.setupSystemThemeListener();
            }

            applyTheme() {
                const root = document.documentElement;
                const body = document.body;
                
                if (this.theme === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
                } else {
                    root.setAttribute('data-theme', this.theme);
                }
                
                // Update theme toggle icon
                const themeIcon = document.querySelector('.theme-icon');
                if (themeIcon) {
                    const icons = { auto: 'üåì', light: '‚òÄÔ∏è', dark: 'üåô' };
                    themeIcon.textContent = icons[this.theme];
                }
                
                // Update select in settings
                const themeSelect = document.getElementById('themeSelect');
                if (themeSelect) {
                    themeSelect.value = this.theme;
                }
            }

            toggleTheme() {
                const themes = ['auto', 'light', 'dark'];
                const currentIndex = themes.indexOf(this.theme);
                this.theme = themes[(currentIndex + 1) % themes.length];
                
                localStorage.setItem('theme', this.theme);
                this.applyTheme();
            }

            setupThemeToggle() {
                const themeToggle = document.getElementById('themeToggle');
                const themeSelect = document.getElementById('themeSelect');
                
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => this.toggleTheme());
                }
                
                if (themeSelect) {
                    themeSelect.addEventListener('change', (e) => {
                        this.theme = e.target.value;
                        localStorage.setItem('theme', this.theme);
                        this.applyTheme();
                    });
                }
            }

            setupSystemThemeListener() {
                if (this.theme === 'auto') {
                    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    mediaQuery.addEventListener('change', () => {
                        if (this.theme === 'auto') {
                            this.applyTheme();
                        }
                    });
                }
            }
        }

        // App Router with URL support
        class AppRouter {
            constructor() {
                this.currentView = 'hub';
                this.routes = {
                    '/': 'hub',
                    '/games': 'games',
                    '/settings': 'settings',
                    '/games/survival': 'survival',
                    '/games/strategy': 'strategy',
                    '/games/rpg-adventure': 'rpg-adventure',
                    '/games/hero-crafting': 'hero-crafting',
                    '/games/house-search': 'house-search',
                    '/games/journal-app': 'journal-app'
                };
                this.init();
            }

            init() {
                this.setupNavigation();
                this.setupGameActions();
                this.setupUrlHandling();
                this.loadCurrentRoute();
                this.populateAllGames();
            }

            setupNavigation() {
                const navTabs = document.querySelectorAll('.nav-tab[data-view]');
                
                navTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        const view = tab.dataset.view;
                        const route = tab.dataset.route || '/';
                        this.navigateToRoute(route);
                    });
                });
            }

            setupGameActions() {
                const actionButtons = document.querySelectorAll('[data-action]');
                const gameCards = document.querySelectorAll('.game-card[data-game]');
                
                actionButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const action = button.dataset.action;
                        this.handleAction(action);
                    });
                });

                gameCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const route = card.dataset.route;
                        if (route) {
                            this.navigateToRoute(route);
                        }
                    });
                });
            }

            setupUrlHandling() {
                window.addEventListener('popstate', () => {
                    this.loadCurrentRoute();
                });
            }

            loadCurrentRoute() {
                const path = window.location.pathname;
                const view = this.routes[path] || 'hub';
                this.navigateTo(view, false);
            }

            navigateToRoute(route) {
                const view = this.routes[route] || 'hub';
                window.history.pushState({}, '', route);
                this.navigateTo(view, true);
            }

            navigateTo(view, updateUrl = false) {
                // Update navigation state
                const navTabs = document.querySelectorAll('.nav-tab[data-view]');
                navTabs.forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.view === view);
                });

                // Update view visibility
                const views = document.querySelectorAll('.view');
                views.forEach(viewEl => {
                    const viewName = viewEl.id.replace('-view', '');
                    viewEl.classList.toggle('active', viewName === view);
                });

                this.currentView = view;
                
                // Trigger view-specific setup
                this.onViewChange(view);
            }

            handleAction(action) {
                switch (action) {
                    case 'play-survival':
                        this.navigateToRoute('/games/survival');
                        break;
                    case 'view-games':
                        this.navigateToRoute('/games');
                        break;
                    default:
                        console.log('Unknown action:', action);
                }
            }

            populateAllGames() {
                const allGamesGrid = document.getElementById('allGamesGrid');
                if (!allGamesGrid) return;

                const games = [
                    {
                        id: 'strategy',
                        name: 'Strategy Wars',
                        icon: 'üè∞',
                        description: 'Command armies, build empires, and conquer territories in this deep strategy game.',
                        badges: ['Strategy', 'Multiplayer'],
                        route: '/games/strategy'
                    },
                    {
                        id: 'survival',
                        name: 'Survival Adventure',
                        icon: 'üèïÔ∏è',
                        description: 'Survive in the wilderness, craft tools, build shelter, and explore a vast open world.',
                        badges: ['Adventure', 'Sandbox'],
                        route: '/games/survival'
                    },
                    {
                        id: 'rpg-adventure',
                        name: 'RPG Adventure',
                        icon: '‚öîÔ∏è',
                        description: 'Complete RPG framework with combat, progression, quests, and exploration.',
                        badges: ['RPG', 'Educational'],
                        route: '/games/rpg-adventure'
                    },
                    {
                        id: 'hero-crafting',
                        name: 'Hero Forge',
                        icon: 'ü¶∏',
                        description: 'Transform your gaming achievements into legendary heroes with unique classes and abilities.',
                        badges: ['RPG', 'Collection'],
                        route: '/games/hero-crafting'
                    },
                    {
                        id: 'house-search',
                        name: 'Property Risk Checker',
                        icon: 'üè†',
                        description: 'Check environmental risks and hazards near any property address using EPA data and AI analysis.',
                        badges: ['Utility', 'Real Data'],
                        route: '/games/house-search'
                    },
                    {
                        id: 'journal-app',
                        name: 'Life Journal',
                        icon: 'üìñ',
                        description: 'Document your daily life with tags and insights. Track events, people, and experiences.',
                        badges: ['Productivity', 'Personal'],
                        route: '/games/journal-app'
                    }
                ];

                allGamesGrid.innerHTML = games.map(game => `
                    <div class="card game-card" data-game="${game.id}" data-route="${game.route}" tabindex="0" role="button" aria-label="Play ${game.name}">
                        <div class="card-header">
                            <div class="game-icon">${game.icon}</div>
                            <h3 class="card-title">${game.name}</h3>
                            <p class="card-description">${game.description}</p>
                        </div>
                        <div class="game-stats">
                            ${game.badges.map(badge => `<div class="badge badge-primary">${badge}</div>`).join('')}
                        </div>
                    </div>
                `).join('');

                // Re-setup click handlers for new cards
                const newGameCards = allGamesGrid.querySelectorAll('.game-card');
                newGameCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const route = card.dataset.route;
                        if (route) {
                            this.navigateToRoute(route);
                        }
                    });
                });
            }

            onViewChange(view) {
                // Add view change animations
                const activeView = document.querySelector('.view.active');
                if (activeView) {
                    activeView.classList.add('animate-fade-in');
                    setTimeout(() => {
                        activeView.classList.remove('animate-fade-in');
                    }, 300);
                }

                // Trigger stagger animations for grids
                const staggerContainers = document.querySelectorAll('.view.active .stagger-container');
                staggerContainers.forEach(container => {
                    const children = container.children;
                    Array.from(children).forEach((child, index) => {
                        child.style.animationDelay = `${index * 100}ms`;
                        child.classList.add('animate-slide-up');
                    });
                });

                // Initialize games when entering their views
                if (view === 'rpg-adventure') {
                    this.initializeRPGGame();
                } else if (view === 'hero-crafting') {
                    this.initializeHeroCraftingGame();
                } else if (view === 'house-search') {
                    this.initializeHouseSearchGame();
                } else if (view === 'journal-app') {
                    this.initializeJournalApp();
                }
            }

            async initializeRPGGame() {
                try {
                    const container = document.getElementById('rpg-game-container');
                    if (container && !window.rpgGame) {
                        // Create and initialize the RPG game
                        window.rpgGame = new RPGGame();
                        await window.rpgGame.initialize(container);
                        console.log('RPG game initialized successfully!');
                    }
                } catch (error) {
                    console.error('Failed to initialize RPG game:', error);
                    const container = document.getElementById('rpg-game-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="card">
                                <h3>‚ö†Ô∏è Game Loading Error</h3>
                                <p>Failed to load the RPG game. Please refresh the page and try again.</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                            </div>
                        `;
                    }
                }
            }

            async initializeHeroCraftingGame() {
                try {
                    const container = document.getElementById('hero-crafting-container');
                    if (container && !window.heroCraftingGame) {
                        if (window.gameManager) {
                            window.gameManager.launchGame('heroCrafting');
                        } else {
                            // Fallback if gameManager isn't available
                            container.innerHTML = `
                                <div class="card">
                                    <h3>ü¶∏ Hero Forge</h3>
                                    <p>Transform your gaming achievements into legendary heroes!</p>
                                    <p>Game system is loading... Please make sure all game dependencies are loaded.</p>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.error('Failed to initialize Hero Crafting game:', error);
                    const container = document.getElementById('hero-crafting-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="card">
                                <h3>‚ö†Ô∏è Game Loading Error</h3>
                                <p>Failed to load Hero Forge. Please refresh the page and try again.</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                            </div>
                        `;
                    }
                }
            }

            async initializeHouseSearchGame() {
                try {
                    const container = document.getElementById('house-search-container');
                    if (container && !window.houseSearchGame) {
                        if (window.gameManager) {
                            window.gameManager.launchGame('houseSearch');
                        } else {
                            // Fallback if gameManager isn't available
                            container.innerHTML = `
                                <div class="card">
                                    <h3>üè† Property Risk Checker</h3>
                                    <p>Check environmental risks near any property address using EPA data!</p>
                                    <p>Game system is loading... Please make sure all game dependencies are loaded.</p>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.error('Failed to initialize House Search game:', error);
                    const container = document.getElementById('house-search-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="card">
                                <h3>‚ö†Ô∏è Game Loading Error</h3>
                                <p>Failed to load Property Risk Checker. Please refresh the page and try again.</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                            </div>
                        `;
                    }
                }
            }

            async initializeJournalApp() {
                try {
                    const container = document.getElementById('journal-app-container');
                    if (container && !window.journalAppGame) {
                        if (window.gameManager) {
                            window.gameManager.launchGame('journalApp');
                        } else {
                            // Fallback if gameManager isn't available
                            container.innerHTML = `
                                <div class="card">
                                    <h3>üìñ Life Journal</h3>
                                    <p>Document your daily life with tags and insights!</p>
                                    <p>Game system is loading... Please make sure all game dependencies are loaded.</p>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.error('Failed to initialize Journal App:', error);
                    const container = document.getElementById('journal-app-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="card">
                                <h3>‚ö†Ô∏è Game Loading Error</h3>
                                <p>Failed to load Life Journal. Please refresh the page and try again.</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                            </div>
                        `;
                    }
                }
            }
        }

        // App initialization
        document.addEventListener('DOMContentLoaded', () => {
            // Hide loading screen
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }

            // Initialize app systems
            window.themeManager = new ThemeManager();
            window.appRouter = new AppRouter();
            
            // Performance metrics
            const loadTime = performance.now() - startTime;
            console.log(`App loaded in ${loadTime.toFixed(2)}ms`);
        });

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.style.display = 'inline-flex';
                installBtn.addEventListener('click', () => {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                            installBtn.style.display = 'none';
                        }
                        deferredPrompt = null;
                    });
                });
            }
        });

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>

</body>
</html>